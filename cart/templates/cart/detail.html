{% extends 'base.html' %}
{% load static %}

{% block title %}Cart{% endblock %}

{% block content %}
  <h1>Cart</h1>
  <table class="table" id="dataTable">
    <thead>
      <tr>
        <th style="width: 18%">Image</th>
        <th>Categorie</th>
        <th style="width: 15%">Quantity</th>
        <th style="width: 10%;">Remove</th>
      </tr>
    </thead>

    <tbody>
      {% for item in cart %}
        <tr>
          <td><img src="{{ item.category.image.url }}" width="100" height="100"></td>
          <td>{{ item.category.name }}</td>
          <td>
            <p>{{ item.quantity }}</p>
            {% comment %}
            <form action="{% url 'cart:cart_add' item.category.id %}" method="post">
              {% csrf_token %}
              <input id="quantity-{{ item.category.id }}" bs-data="{{ item.category.id }}" type="number" name="quantity" min="1" value="{{ item.quantity }}">
              <input type="hidden" name="override" value="True">
              <button class="btn btn-sm btn-primary" type="submit">Update</button>
            </form>
            {% endcomment %}
          </td>
          <td>
            <form action="{% url 'cart:cart_remove' item.category.id %}" method="post">
              {% csrf_token %}
              <button class="btn btn-sm btn-danger">Remove</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <p>
  {% with total_items=cart|length %}
  {% if total_items > 0 %}
  You have {{ total_items }} items in your cart.
  
  {% endif %}
  {% endwith %}
  </p>


  <p style="text-align: right">
    <button id="checkout" class="btn btn-success">Checkout</button>
    <a href="{{ request.META.HTTP_REFERER }}" class="btn btn-primary">Continue Shopping</a>
    <!-- <button class="btn btn-primary" id="continueShopping">Continue Shopping</button> -->
  </p>

  <script>
    $(document).ready(() => {
      $("#dataTable").DataTable({
        "fnDrawCallback" : function(oSettings) {
          if (oSettings._iDisplayLength > oSettings.fnRecordsDisplay()) {
            $(oSettings.nTableWrapper).find('.dataTables_paginate').hide();
          } else {
            $(oSettings.nTableWrapper).find('.dataTables_paginate').show();
          }
        },
        "lengthMenu": [ [5, 10, 25, 50, -1], [5, 10, 25, 50, "All"] ],
      });
    });

    /*
    {% for item in cart %}
    var quantity = $("#quantity-{{ item.category.id }}");
    var remaing_in_stock = $.ajax({
      url: "{% url 'cart:remain_in_stock' item.category.id %}",
      success: function(data) {
        quantity.attr("max", data['count']);
        console.log(data);
      }
    })
    {% endfor %}
    */


    $("#checkout").click(function() {
      $.post(
        "{% url 'parcel:bill_create' %}",
        {
          csrfmiddlewaretoken: "{{ csrf_token }}"
        }
      )
    })

    
  </script>
{% endblock %}
